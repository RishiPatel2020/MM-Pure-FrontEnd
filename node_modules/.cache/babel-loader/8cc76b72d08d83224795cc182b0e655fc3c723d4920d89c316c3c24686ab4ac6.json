{"ast":null,"code":"var _jsxFileName = \"/Users/rishipatel/Documents/Coding/WebDevelopment/FullStackProjects/TiffinService/MM-backend/MM_Backend/MM-Backend/front-end/src/SharedComponents/PopUp/Payment/Payment.js\",\n  _s = $RefreshSig$();\nimport PopUp from \"../PopUp\";\nimport userSession from \"../../../Service/userSession\";\nimport StripeCheckout from \"react-stripe-checkout\";\nimport OrderAPIService from \"../../../Service/OrderAPIService\";\nimport { useEffect } from \"react\";\nimport StripeBackend from \"../../../Service/StripeBackend\";\nimport { useState } from \"react\";\nimport React from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Payment = _ref => {\n  _s();\n  let {\n    cart,\n    setCart,\n    mealNumbers,\n    cartPrice,\n    setCartPrice,\n    setNumMealsSelected,\n    delivDate,\n    showPayPopUp,\n    setShowPopUp\n  } = _ref;\n  // To give users live update about making payment & storing order\n  const [statusPopUp, setStatusPopUp] = useState(false);\n  const [statusTitle, setStatusTitle] = useState(\"\");\n  const [statusBody, setStatusBody] = useState(\"\");\n  const STRIPE_KEY = \"pk_test_51MLGUDLxe44udBspRQVfTcgFGVZRI6NRIlrfX4lexUptlrYTJjsqfJZFBeDrKXdyOCiJVVQKcD88WAQDsNPVWZ9b00bKBn0FaU\";\n\n  // stripeToken will have store shipping info\n  const [stripeToken, setStripeToken] = useState(null);\n  const onToken = token => {\n    setStripeToken(token);\n    console.log(\"TOKEN::: \" + JSON.stringify(token));\n  };\n  use;\n  useEffect(() => {\n    const makeRequest = () => {\n      setStatusTitle(\"Payment Status\");\n      // Sending req to backend to create charge based on card details entered by user..\n      StripeBackend.requestToServer(stripeToken, cartPrice * 100, setStatusBody, setStatusPopUp) // Response received from backend and we know if payment succeded or not\n      .then(res => {\n        // Payment failed\n        if (res.status === 206) {\n          setStatusBody(res.data);\n          // let user view err msg for 2s; close pop up; reopen payment pop up\n          setTimeout(() => {\n            setStatusPopUp(false);\n            document.getElementById(\"hiddenPaymentButton\").click();\n          }, 2000);\n        } else {\n          // Successful payment; so, STORE ORDER IN DB\n          setStatusBody(\"Successful Payment!\");\n          setTimeout(() => {\n            setStatusTitle(\"Order Status\");\n            setStatusBody(\"Sending Order to DB....\");\n          }, 1000);\n          setTimeout(() => {\n            // mealAndFreqsArr is in format: [[id1,q1],[id2,q2]....]\n            const mealAndFreqsArr = [];\n            cart.map(item => {\n              mealAndFreqsArr.push([item.id, mealNumbers[item.id]]);\n            });\n            let todaysDate = new Date().toDateString();\n            const objToSend = {\n              Order_date: todaysDate,\n              Shipping_date: delivDate,\n              Total_Price: cartPrice,\n              email: stripeToken.email,\n              Address: `${stripeToken.card.address_line1} ${stripeToken.card.address_city}, ${stripeToken.card.address_zip}`,\n              Customer_id: userSession.getUser().id,\n              mealAndFreqs: mealAndFreqsArr\n            };\n            // setStatusTitle(\"Order Status\");\n            OrderAPIService.addOrder(objToSend, setStatusBody).then(res => {\n              setStatusBody(\"Order saved in DB! Order#: \" + res.data);\n              // after 2 seconds close the pop up\n              setTimeout(() => {\n                setStatusPopUp(false);\n                // here we empty previous token\n                setStripeToken(null);\n              }, 2000);\n            }).catch(err => {\n              setStatusBody(\"Could NOT store the order please contact Admin \");\n              // after 2 seconds close the pop up\n              setTimeout(() => {\n                setStatusPopUp(false);\n                // here we empty previous token\n                setStripeToken(null);\n              }, 2000);\n            });\n\n            // SUCCESS; RESET: cart, numMealsSelected, mealNumbers\n            setCart([]);\n            setNumMealsSelected(0);\n            setCartPrice(0);\n            for (let index = 0; index < mealNumbers.length; index++) {\n              mealNumbers[index] = 0;\n            }\n          }, 1200);\n        }\n      }).catch(error => {\n        setStatusPopUp(true);\n        setStatusBody(\"\" + error);\n        setTimeout(() => {\n          setStatusPopUp(false);\n          document.getElementById(\"hiddenPaymentButton\").click();\n        }, 3000);\n      });\n    };\n    stripeToken && makeRequest();\n  }, [stripeToken]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [\"// Regular Stripe pop UP\", /*#__PURE__*/_jsxDEV(StripeCheckout, {\n      name: \"Mirchi Meals\",\n      shippingAddress: true,\n      billingAddress: true,\n      description: `Total: $${cartPrice}`,\n      amount: cartPrice * 100,\n      token: onToken,\n      stripeKey: STRIPE_KEY,\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        id: \"hiddenPaymentButton\",\n        style: {\n          borderColor: \"blue\",\n          padding: \"10px\",\n          fontSize: \"large\",\n          margin: \"50%\",\n          height: \"70px\",\n          width: \"100px\",\n          backgroundColor: \"black\"\n        },\n        hidden: true,\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: \"white\"\n          },\n          children: [\"Pay $\", cartPrice]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PopUp, {\n      displayPopUp: statusPopUp,\n      setDisplayPopUp: setStatusPopUp,\n      title: statusTitle,\n      body: statusBody\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(Payment, \"qD1uBNiMktsUa12cxB5lxkfJccs=\");\n_c = Payment;\nexport default Payment;\nvar _c;\n$RefreshReg$(_c, \"Payment\");","map":{"version":3,"names":["PopUp","userSession","StripeCheckout","OrderAPIService","useEffect","StripeBackend","useState","React","Payment","cart","setCart","mealNumbers","cartPrice","setCartPrice","setNumMealsSelected","delivDate","showPayPopUp","setShowPopUp","statusPopUp","setStatusPopUp","statusTitle","setStatusTitle","statusBody","setStatusBody","STRIPE_KEY","stripeToken","setStripeToken","onToken","token","console","log","JSON","stringify","use","makeRequest","requestToServer","then","res","status","data","setTimeout","document","getElementById","click","mealAndFreqsArr","map","item","push","id","todaysDate","Date","toDateString","objToSend","Order_date","Shipping_date","Total_Price","email","Address","card","address_line1","address_city","address_zip","Customer_id","getUser","mealAndFreqs","addOrder","catch","err","index","length","error","borderColor","padding","fontSize","margin","height","width","backgroundColor","color"],"sources":["/Users/rishipatel/Documents/Coding/WebDevelopment/FullStackProjects/TiffinService/MM-backend/MM_Backend/MM-Backend/front-end/src/SharedComponents/PopUp/Payment/Payment.js"],"sourcesContent":["import PopUp from \"../PopUp\";\nimport userSession from \"../../../Service/userSession\";\nimport StripeCheckout from \"react-stripe-checkout\";\nimport OrderAPIService from \"../../../Service/OrderAPIService\";\nimport { useEffect } from \"react\";\nimport StripeBackend from \"../../../Service/StripeBackend\";\n\nimport { useState } from \"react\";\nimport React from \"react\";\n\nconst Payment = ({\n  cart,\n  setCart,\n  mealNumbers,\n  cartPrice,\n  setCartPrice,\n  setNumMealsSelected,\n  delivDate,\n  showPayPopUp,\n  setShowPopUp\n}) => {\n  // To give users live update about making payment & storing order\n  const [statusPopUp, setStatusPopUp] = useState(false);\n  const [statusTitle, setStatusTitle] = useState(\"\");\n  const [statusBody, setStatusBody] = useState(\"\");\n  const STRIPE_KEY =\n    \"pk_test_51MLGUDLxe44udBspRQVfTcgFGVZRI6NRIlrfX4lexUptlrYTJjsqfJZFBeDrKXdyOCiJVVQKcD88WAQDsNPVWZ9b00bKBn0FaU\";\n\n  // stripeToken will have store shipping info\n  const [stripeToken, setStripeToken] = useState(null);\n  const onToken = (token) => {\n    setStripeToken(token);\n    console.log(\"TOKEN::: \" + JSON.stringify(token));\n  };\n\n  use\n\n  useEffect(() => {\n    const makeRequest = () => {\n      setStatusTitle(\"Payment Status\");\n      // Sending req to backend to create charge based on card details entered by user..\n      StripeBackend.requestToServer(\n        stripeToken,\n        cartPrice * 100,\n        setStatusBody,\n        setStatusPopUp\n      ) // Response received from backend and we know if payment succeded or not\n        .then((res) => {\n          // Payment failed\n          if (res.status === 206) {\n            setStatusBody(res.data);\n            // let user view err msg for 2s; close pop up; reopen payment pop up\n            setTimeout(() => {\n              setStatusPopUp(false);\n              document.getElementById(\"hiddenPaymentButton\").click();\n            }, 2000);\n          } else {\n            // Successful payment; so, STORE ORDER IN DB\n            setStatusBody(\"Successful Payment!\");\n            setTimeout(() => {\n              setStatusTitle(\"Order Status\");\n              setStatusBody(\"Sending Order to DB....\");\n            }, 1000);\n            setTimeout(() => {\n              // mealAndFreqsArr is in format: [[id1,q1],[id2,q2]....]\n              const mealAndFreqsArr = [];\n              cart.map((item) => {\n                mealAndFreqsArr.push([item.id, mealNumbers[item.id]]);\n              });\n\n              let todaysDate = new Date().toDateString();\n\n              const objToSend = {\n                Order_date: todaysDate,\n                Shipping_date: delivDate,\n                Total_Price: cartPrice,\n                email: stripeToken.email,\n                Address: `${stripeToken.card.address_line1} ${stripeToken.card.address_city}, ${stripeToken.card.address_zip}`,\n                Customer_id: userSession.getUser().id,\n                mealAndFreqs: mealAndFreqsArr,\n              };\n              // setStatusTitle(\"Order Status\");\n              OrderAPIService.addOrder(objToSend, setStatusBody)\n                .then((res) => {\n                  setStatusBody(\"Order saved in DB! Order#: \" + res.data);\n                  // after 2 seconds close the pop up\n                  setTimeout(() => {\n                    setStatusPopUp(false);\n                    // here we empty previous token\n                    setStripeToken(null);\n                  }, 2000);\n                })\n                .catch((err) => {\n                  setStatusBody(\n                    \"Could NOT store the order please contact Admin \"\n                  );\n                  // after 2 seconds close the pop up\n                  setTimeout(() => {\n                    setStatusPopUp(false);\n                    // here we empty previous token\n                    setStripeToken(null);\n                  }, 2000);\n                });\n\n              // SUCCESS; RESET: cart, numMealsSelected, mealNumbers\n              setCart([]);\n              setNumMealsSelected(0);\n              setCartPrice(0);\n              for (let index = 0; index < mealNumbers.length; index++) {\n                mealNumbers[index] = 0;\n              }\n            }, 1200);\n          }\n        })\n        .catch((error) => {\n          setStatusPopUp(true);\n          setStatusBody(\"\" + error);\n          setTimeout(() => {\n            setStatusPopUp(false);\n            document.getElementById(\"hiddenPaymentButton\").click();\n          }, 3000);\n        });\n    };\n    stripeToken && makeRequest();\n  }, [stripeToken]);\n\n  return (\n    <>\n      // Regular Stripe pop UP\n      <StripeCheckout\n        name=\"Mirchi Meals\"\n        shippingAddress\n        billingAddress\n        description={`Total: $${cartPrice}`}\n        amount={cartPrice * 100}\n        token={onToken}\n        stripeKey={STRIPE_KEY}\n      >\n        <button\n          id=\"hiddenPaymentButton\"\n          style={{\n            borderColor: \"blue\",\n            padding: \"10px\",\n            fontSize: \"large\",\n            margin: \"50%\",\n            height: \"70px\",\n            width: \"100px\",\n            backgroundColor: \"black\",\n          }}\n          hidden\n        >\n          <span style={{ color: \"white\" }}>Pay ${cartPrice}</span>\n        </button>\n      </StripeCheckout>\n      <PopUp\n        displayPopUp={statusPopUp}\n        setDisplayPopUp={setStatusPopUp}\n        title={statusTitle}\n        body={statusBody}\n      />\n    </>\n  );\n};\n\nexport default Payment;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}